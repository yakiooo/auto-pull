import tkinter as tk
from tkinter import messagebox
import time
import threading
from pynput import keyboard


class AutoInputApp:
    def __init__(self, root):
        self.root = root
        self.root.title("è‡ªåŠ¨è¾“å…¥å·¥å…·")
        self.root.geometry("800x600")
        self.root.configure(bg='lightblue')

        self.is_running = False
        self.is_paused = False
        self.controller = keyboard.Controller()

        main_frame = tk.Frame(root, bg='lightblue')
        main_frame.pack(fill=tk.BOTH, expand=True, padx=20, pady=20)

        self.create_widgets(main_frame)

    def create_widgets(self, parent):
        # æ ‡é¢˜
        title_label = tk.Label(parent, text="è‡ªåŠ¨è¾“å…¥å·¥å…·",
                               font=("Microsoft YaHei", 24, "bold"),
                               bg='lightblue', fg='darkblue')
        title_label.pack(pady=10)

        # è¯´æ˜æ–‡å­—
        instruction = tk.Label(parent,
                               text="åœ¨ä¸‹é¢çš„å¤§æ¡†é‡Œç²˜è´´æ–‡å­—ï¼Œç„¶åç‚¹å‡»ä¸‹é¢çš„å¤§æŒ‰é’®\nä½¿ç”¨pynputåº“é€å­—ç¬¦è¾“å…¥ï¼Œå®Œç¾æ”¯æŒä¸­æ–‡",
                               font=("Microsoft YaHei", 14),
                               bg='lightblue', fg='black')
        instruction.pack(pady=5)

        # æ–‡æœ¬æ¡†
        self.text_area = tk.Text(parent, height=8,
                                 font=("Microsoft YaHei", 12),
                                 bg='white', fg='black')
        self.text_area.pack(fill=tk.BOTH, expand=True, pady=10, padx=20)

        # æ§åˆ¶æŒ‰é’®æ¡†æ¶
        button_frame = tk.Frame(parent, bg='lightblue')
        button_frame.pack(fill=tk.X, pady=10, padx=20)

        # æäº¤æŒ‰é’®
        self.submit_btn = tk.Button(button_frame,
                                    text="ğŸŒŸ å¼€å§‹è¾“å…¥ ğŸŒŸ",
                                    command=self.start_auto_input,
                                    font=("Microsoft YaHei", 16, "bold"),
                                    bg="yellow",
                                    fg="red",
                                    width=15)
        self.submit_btn.pack(side=tk.LEFT, padx=10)

        # æš‚åœ/ç»§ç»­æŒ‰é’®
        self.pause_btn = tk.Button(button_frame,
                                   text="â¸ï¸ æš‚åœ",
                                   command=self.toggle_pause,
                                   font=("Microsoft YaHei", 14, "bold"),
                                   bg="orange",
                                   fg="white",
                                   width=10,
                                   state=tk.DISABLED)
        self.pause_btn.pack(side=tk.LEFT, padx=10)

        # åœæ­¢æŒ‰é’®
        self.stop_btn = tk.Button(button_frame,
                                  text="â¹ï¸ åœæ­¢",
                                  command=self.stop_auto_input,
                                  font=("Microsoft YaHei", 14, "bold"),
                                  bg="red",
                                  fg="white",
                                  width=10,
                                  state=tk.DISABLED)
        self.stop_btn.pack(side=tk.LEFT, padx=10)

        # è¾“å…¥é€Ÿåº¦è®¾ç½®
        speed_frame = tk.Frame(parent, bg='lightblue')
        speed_frame.pack(fill=tk.X, pady=5, padx=20)

        speed_label = tk.Label(speed_frame, text="è¾“å…¥é€Ÿåº¦(ç§’/å­—ç¬¦):",
                               font=("Microsoft YaHei", 12),
                               bg='lightblue', fg='black')
        speed_label.pack(side=tk.LEFT)

        self.speed_var = tk.DoubleVar(value=0.05)
        speed_scale = tk.Scale(speed_frame, from_=0.01, to=0.5, resolution=0.01,
                               orient=tk.HORIZONTAL, variable=self.speed_var,
                               length=200, bg='lightblue', font=("Microsoft YaHei", 10))
        speed_scale.pack(side=tk.LEFT, padx=10)

        # çŠ¶æ€æ˜¾ç¤º
        self.status_label = tk.Label(parent, text="å‡†å¤‡å°±ç»ª",
                                     font=("Microsoft YaHei", 14, "bold"),
                                     bg='lightblue', fg='green')
        self.status_label.pack(pady=5)

    def start_auto_input(self):
        text_content = self.text_area.get("1.0", tk.END).strip()

        if not text_content:
            messagebox.showwarning("æç¤º", "è¯·å…ˆåœ¨ç™½è‰²å¤§æ¡†é‡Œè¾“å…¥æ–‡å­—ï¼")
            return

        # ç¦ç”¨å¼€å§‹æŒ‰é’®ï¼Œå¯ç”¨æš‚åœå’Œåœæ­¢æŒ‰é’®
        self.submit_btn.config(state=tk.DISABLED, bg='gray')
        self.pause_btn.config(state=tk.NORMAL)
        self.stop_btn.config(state=tk.NORMAL)

        self.is_running = True
        self.is_paused = False
        self.status_label.config(text="3ç§’åå¼€å§‹è¾“å…¥ï¼Œè¯·ç¡®ä¿å…‰æ ‡åœ¨è¾“å…¥ä½ç½®...", fg='orange')

        thread = threading.Thread(target=self.auto_input_thread, args=(text_content,))
        thread.daemon = True
        thread.start()

    def toggle_pause(self):
        if self.is_paused:
            # ç»§ç»­è¾“å…¥
            self.is_paused = False
            self.pause_btn.config(text="â¸ï¸ æš‚åœ", bg="orange")
            self.status_label.config(text="å·²ç»§ç»­è¾“å…¥...", fg='blue')
        else:
            # æš‚åœè¾“å…¥
            self.is_paused = True
            self.pause_btn.config(text="â–¶ï¸ ç»§ç»­", bg="green")
            self.status_label.config(text="å·²æš‚åœï¼Œç‚¹å‡»ç»§ç»­æŒ‰é’®æ¢å¤...", fg='orange')

    def stop_auto_input(self):
        self.is_running = False
        self.is_paused = False
        self.reset_buttons()
        self.status_label.config(text="å·²åœæ­¢è¾“å…¥", fg='red')

    def reset_buttons(self):
        """é‡ç½®æŒ‰é’®çŠ¶æ€"""
        self.submit_btn.config(state=tk.NORMAL, bg='yellow')
        self.pause_btn.config(state=tk.DISABLED, text="â¸ï¸ æš‚åœ", bg="orange")
        self.stop_btn.config(state=tk.DISABLED)

    def auto_input_thread(self, text_content):
        # 3ç§’å€’è®¡æ—¶
        for i in range(3, 0, -1):
            if not self.is_running:
                return
            self.status_label.config(text=f"{i}ç§’åå¼€å§‹è¾“å…¥...")
            time.sleep(1)

        if not self.is_running:
            return

        # å¼€å§‹è¾“å…¥
        self.status_label.config(text="æ­£åœ¨è¾“å…¥ä¸­...", fg='blue')

        try:
            # ä½¿ç”¨pynputé€å­—ç¬¦è¾“å…¥ï¼ˆå®Œç¾æ”¯æŒä¸­æ–‡ï¼‰
            input_speed = self.speed_var.get()

            for char in text_content:
                # æ£€æŸ¥æ˜¯å¦åœæ­¢
                if not self.is_running:
                    break

                # æ£€æŸ¥æ˜¯å¦æš‚åœ
                while self.is_paused and self.is_running:
                    time.sleep(0.1)

                if not self.is_running:
                    break

                # å¤„ç†ç‰¹æ®Šå­—ç¬¦
                if char == '\n':  # æ¢è¡Œç¬¦
                    self.controller.press(keyboard.Key.enter)
                    self.controller.release(keyboard.Key.enter)
                elif char == '\t':  # åˆ¶è¡¨ç¬¦
                    self.controller.press(keyboard.Key.tab)
                    self.controller.release(keyboard.Key.tab)
                else:
                    # è¾“å…¥æ™®é€šå­—ç¬¦ï¼ˆåŒ…æ‹¬ä¸­æ–‡ï¼‰
                    self.controller.type(char)

                # æ ¹æ®è®¾ç½®çš„é€Ÿåº¦ç­‰å¾…
                time.sleep(input_speed)

            if self.is_running:
                self.status_label.config(text="è¾“å…¥å®Œæˆï¼", fg='green')

        except Exception as e:
            self.status_label.config(text=f"é”™è¯¯: {str(e)}", fg='red')

        # æ¢å¤æŒ‰é’®çŠ¶æ€
        self.root.after(0, self.reset_buttons)


# è¿è¡Œç¨‹åº
if __name__ == "__main__":
    try:
        from pynput import keyboard
    except ImportError:
        print("è¯·å…ˆå®‰è£…ä¾èµ–: pip install pynput")
        exit()

    root = tk.Tk()
    app = AutoInputApp(root)
    root.mainloop()
